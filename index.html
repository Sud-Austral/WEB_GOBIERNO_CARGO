<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Gestión Candidatos</title>
</head>

<body class="bg-white overflow-hidden">

    <div class="row g-0 vh-100">
        <!-- Left Side: Cover Image -->
        <div class="col-lg-7 d-none d-lg-block position-relative">
            <div class="position-absolute w-100 h-100" style="
                background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop');
                background-size: cover;
                background-position: center;
                filter: brightness(0.7);">
            </div>
            <div class="position-absolute bottom-0 start-0 p-5 text-white"
                style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);">
                <h1 class="fw-bold display-4">Gestión de Talento</h1>
                <p class="lead mb-4">Plataforma integral para la administración, seguimiento y selección de candidatos
                    de alto desempeño.</p>
                <small class="opacity-75">&copy; 2026 Sistema Corporativo v2.0</small>
            </div>
        </div>

        <!-- Right Side: Login Form -->
        <div
            class="col-lg-5 col-md-12 d-flex align-items-center justify-content-center bg-white shadow-lg position-relative">
            <div class="w-100 p-5" style="max-width: 500px;">
                <div class="text-center mb-5">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                        style="width: 64px; height: 64px;">
                        <i class="fas fa-user-tie fa-2x"></i>
                    </div>
                    <h3 class="fw-bold text-dark">Bienvenido de nuevo</h3>
                    <p class="text-muted">Ingrese a su panel de control administrativo</p>
                </div>

                <form id="loginForm">
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
                        <label for="email">Correo Electrónico</label>
                    </div>
                    <div class="form-floating mb-4">
                        <input type="password" class="form-control" id="password" placeholder="Password" required>
                        <label for="password">Contraseña</label>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="rememberMe">
                            <label class="form-check-label text-muted small" for="rememberMe">Recuérdame</label>
                        </div>
                        <a href="#" class="text-decoration-none small text-primary fw-bold">¿Olvidó su contraseña?</a>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-3 fw-bold shadow-sm mb-3 lead">
                        Iniciar Sesión <i class="fas fa-arrow-right ms-2"></i>
                    </button>

                    <div class="alert alert-danger d-none border-0 shadow-sm bg-danger text-white mt-3" id="loginError">
                        <i class="fas fa-exclamation-circle me-2"></i> Credenciales incorrectas.
                    </div>
                </form>

                <div class="text-center mt-5 pt-4 border-top">
                    <p class="text-muted small mb-0">¿Necesita acceso?</p>
                    <a href="#" class="fw-bold text-dark text-decoration-none small">Contacte al Administrador del
                        Sistema</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Common JS (Libs & Styles) -->
    <script src="common.js"></script>
    <script>
        // Override body background logic from common.js just for this page if needed, 
        // but since we define structure above styles, common.js styles will apply.
        // We use classes to override background.

        if (isAuthenticated()) window.location.href = "dashboard.html";

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const alertBox = document.getElementById('loginError');

            const originalBtn = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
            alertBox.classList.add('d-none');

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                // Check if running static demo (no backend)
                // If common.js API_URL is localhost but not running, it might fail.
                // Assuming backend is up as per user context.

                const res = await fetchAPI('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });

                if (res && res.ok) {
                    const data = await res.json();
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));

                    // Simple animation before redirect
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-success');
                    btn.innerHTML = '<i class="fas fa-check"></i> Acceso Correcto';
                    setTimeout(() => window.location.href = 'dashboard.html', 500);
                } else {
                    throw new Error("Credenciales inválidas");
                }
            } catch (err) {
                alertBox.classList.remove('d-none');
                btn.disabled = false;
                btn.innerHTML = originalBtn;
                console.error(err);
            }
        });
    </script>
</body>

</html>