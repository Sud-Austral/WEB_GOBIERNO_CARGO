<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Gestión Candidatos</title>
    <!-- CSS is loaded by common.js, but since this is login we might not have navbar.
         common.js injects libs. We just need to wait for them or just hardcode basic css to avoid FOUC?
         Actually common.js injects styles immediately. We just need a container. -->
</head>

<body class="bg-light">

    <div class="container d-flex align-items-center justify-content-center" style="min-height: 100vh;">
        <div class="card shadow border-0" style="width: 100%; max-width: 400px;">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <i class="fas fa-users-cog text-primary" style="font-size: 3rem;"></i>
                    <h4 class="mt-3 fw-bold text-dark">Gestión Candidatos</h4>
                    <p class="text-muted small">Ingrese sus credenciales para continuar</p>
                </div>

                <form id="loginForm">
                    <div class="mb-3">
                        <label class="form-label text-secondary small fw-bold">Email</label>
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0"><i
                                    class="fas fa-envelope text-muted"></i></span>
                            <input type="email" id="email" class="form-control border-start-0 ps-0"
                                placeholder="usuario@correo.com" required>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label text-secondary small fw-bold">Contraseña</label>
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0"><i
                                    class="fas fa-lock text-muted"></i></span>
                            <input type="password" id="password" class="form-control border-start-0 ps-0"
                                placeholder="••••••••" required>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">Acceder</button>

                    <div class="alert alert-danger mt-3 d-none" id="loginError" role="alert">
                        Error al iniciar sesión. Verifique sus datos.
                    </div>
                </form>

                <div class="text-center mt-4 text-muted small">
                    &copy; 2026 Empresa Corporativa
                </div>
            </div>
        </div>
    </div>

    <!-- We load common.js to get dependencies injected -->
    <script src="common.js"></script>
    <script>
        // Check if already logged in
        if (isAuthenticated()) window.location.href = "dashboard.html";

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const alertBox = document.getElementById('loginError');

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
            alertBox.classList.add('d-none');

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const res = await fetchAPI('/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });

            if (res && res.ok) {
                const data = await res.json();
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                window.location.href = 'dashboard.html';
            } else {
                alertBox.classList.remove('d-none');
                btn.disabled = false;
                btn.innerHTML = 'Acceder';
            }
        });
    </script>
</body>

</html>